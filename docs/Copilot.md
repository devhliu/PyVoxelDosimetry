# Questions to Claude 3.5 Sonnet

> write a python package (named pyvoxeldosimetry) to calculate internal dosimetry at voxel level for radionuclide tracers. The package should be able to handle different types of radionuclides and their decay properties, which can be configured or loaded from config file or a specified folder. The calculation methods includes 3 types of method: 1. local energy deposition, 2. dose kernel convolution, 3. GPU accelerated Monte Carlo simulation where the dominant physics for photons, betas, positrons and the alpha particles are considered. The input data will be multiple / single time point SPECT/CT or PET/CT depending the tracer used, where the registration among different timepoints are performed using elestix, ants or greedy. The radionuclide tracers include but not limited to （list all below data for Decay property and also Dose Kernel for different spatial resolution）: 18F, 68Ga, 64Cu, 89Zr, 90Y, 131I, 177Lu, 161Tb, 225Ac, 212Pb etc.... The tissue compotision will be calcalated from CT images, and deep learning organ segmentation are performed to construct the tissue composition. The package should also handle the iodine contrast, metal inplants and other artifacts when generating tissue composition using CT images. The tissue considered includes air, lung, soft tissue, bone and water in addition to the above artifacts. The package should be able to handle multiple time points and perform registration among them. The input data are in Nifti format. Three calculation methods, and tissue compsition module are sepearated into three different modules. The package should be able to handle the calculation of internal dosimetry at voxel level for radionuclide tracers and generate output in Nifti format. The 3D volumetric SPECT data can be quantitative one or a calibration factor configured. The output will be dosimetry rate map in each timepoint and also the accumulated dosimetry by fitting and integrating all timepoints to infinite time such as 100 * half time, and the time curve fitting are also seperated into a independent module. 
> 1st refinement: add nnunetv2 for organ segmentation and lesion segmentation. put the dose kernel data into seperated folder in this package. The dose kernel shall include 18F, 68Ga, 64Cu, 89Zr, 90Y, 131I, 177Lu, 161Tb, 225Ac, 212Pb. Then re-generated the package.
> 2nd refinement: for monte carlo method, load the the radionuclide decay properties data from a folder, which is named mc_decay from data path.
> 3rd refinement: json format is used for config, and all radionuclide properties are saved in data/mc_decay folder or data/dose_kernels folder. The python code inside the config folder is used to read the configurations from data folders and package configuration. The general package configuration and computing parameters are stored in config folder. regenerate python code inside config folder and radionuclide settings in data folder perspectively for mc_decay (monte carlo method) and dose_kernels (Dose Kernel Convolution method). 
> 4th refinement: update or re-organize the python code to support on-the-fly dose kernel generation for 18F, 68Ga, 64Cu, 89Zr, 90Y, Tc99m, 131I, 177Lu, 161Tb, 225Ac, 212Pb with respect of tissue compoisition, such as water, lung, soft tissue, bone, iodine contrast and metal artifacts. The dose kernel property for each radionuclide (X) is stored pyvoxeldometry/data/dose_kernels/X as json settings, and its on-the-fly dose kernel generation python code is inside the folder for pyvoxeldometry/data/dose_kernels with I/O functionality. The kernel is stored into 2d png format and numpy format.